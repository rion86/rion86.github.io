<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ラテール エンチャント評価</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; 
            color: #1f2937; 
            padding: 0; 
            margin: 0; 
            min-height: 100vh; 
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .main-container {
            width: 100%; 
            max-width: 1600px; 
            margin: 0 auto; 
            padding: 0.5rem 1.5rem; 
            background-color: #ffffff; 
            border-radius: 0.75rem; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); 
            display: flex;
            flex-direction: column;
            min-height: calc(100vh - 70px - 40px); 
        }
        @media (min-width: 1024px) {
            .main-container {
                padding: 1rem 2rem; 
            }
        }

        .header-area {
            display: flex;
            flex-direction: column;
            align-items: flex-start; 
            width: 100%;
            margin-bottom: 0.8rem; 
        }
        @media (min-width: 640px) {
            .header-area {
                flex-direction: row;
                justify-content: space-between; 
                align-items: center;
                margin-bottom: 1rem; 
            }
        }

        .site-title {
            font-size: 0.9rem; 
            font-weight: 700; 
            color: #1f2937; 
            margin-bottom: 0.8rem; 
            text-align: left; 
            padding-left: 0.5rem; 
        }
        @media (min-width: 640px) {
            .site-title {
                font-size: 1.25rem; 
                margin-bottom: 0; 
            }
        }

        .header-right-controls {
            display: flex;
            align-items: center;
            gap: 1.5rem; 
            flex-wrap: wrap; 
            justify-content: flex-end; 
            padding-right: 0.5rem; 
        }

        .equipment-tabs-container {
            display: flex;
            flex-wrap: wrap; 
            gap: 0.5rem; 
        }
        .equipment-tabs-container button {
            padding: 0.6rem 1.2rem; 
            border-radius: 0.5rem; 
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            border: 1px solid transparent; 
            box-shadow: none; 
            font-size: 0.9rem; 
        }
        .equipment-tabs-container button.active {
            background-color: #3b82f6; 
            color: #ffffff;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); 
        }
        .equipment-tabs-container button:not(.active) {
            background-color: #e5e7eb; 
            color: #4b5563; 
            border-color: #d1d5db; 
        }
        .equipment-tabs-container button:not(.active):hover {
            background-color: #d1d5db; 
            color: #1f2937; 
        }

        .reset-button {
            background-color: #ef4444; 
            color: #ffffff;
            padding: 0.6rem 1.2rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            border: 1px solid transparent;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            font-size: 0.9rem;
            margin-left: 1rem; 
        }
        .reset-button:hover {
            background-color: #dc2626; 
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .batch-level-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-left: 1rem;
        }
        .batch-level-control label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #4b5563;
        }
        .batch-level-select {
            width: 60px; 
            padding: 0.6rem 0.8rem; 
            background-color: #ffffff;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            color: #1f2937;
            font-size: 1rem; 
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="%234b5563" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>');
            background-repeat: no-repeat;
            background-position: right 0.2rem center;
            background-size: 0.7rem;
            padding-right: 1.1rem;
            cursor: pointer;
        }
        .batch-level-select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
        }

        .content-area {
            display: flex;
            flex-direction: column; 
            gap: 1.5rem; 
            flex-grow: 1; 
        }
        @media (min-width: 1024px) { 
            .content-area {
                flex-direction: row;
                margin-top: -1rem; 
            }
        }

        .input-panel {
            flex: 1;
            background-color: #ffffff; 
            border-radius: 0.75rem; 
            padding: 1.2rem; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); 
            overflow-y: auto; 
            max-height: calc(100vh - 250px); 
            min-width: 320px; 
            scrollbar-gutter: stable; 
        }
        @media (min-width: 1024px) {
            .input-panel {
                max-height: calc(100vh - 180px);
            }
        }

        .evaluation-panel {
            flex: 1.2; 
            background-color: #ffffff; 
            border-radius: 0.75rem; 
            padding: 1.2rem; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); 
            display: flex;
            flex-direction: column;
            overflow-y: auto; 
            max-height: calc(100vh - 250px); 
            min-width: 280px; 
            scrollbar-gutter: stable; 
        }
        @media (min-width: 1024px) {
            .evaluation-panel {
                max-height: calc(100vh - 180px);
            }
        }

        .enchantment-row {
            background-color: #f9fafb; 
            border: 1px solid #e2e8f0; 
            border-radius: 0.5rem; 
            padding: 0.75rem; 
            margin-bottom: 0.75rem; 
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08); 
            position: relative;
            display: flex; 
            align-items: center; 
            gap: 0.5rem; 
            box-sizing: border-box; 
        }
        
        .enchant-level-name-group {
            display: flex;
            align-items: center;
            gap: 0.5rem; 
            flex-grow: 1; 
        }

        .enchantment-level-select {
            width: 70px; 
            padding: 0.6rem 0.8rem; 
            background-color: #ffffff; 
            border: 1px solid #d1d5db; 
            border-radius: 0.375rem;
            color: #1f2937; 
            font-size: 1rem; 
            appearance: none; 
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="%234b5563" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>');
            background-repeat: no-repeat;
            background-position: right 0.2rem center; 
            background-size: 0.7rem; 
            padding-right: 1.1rem; 
            cursor: pointer;
        }
        .enchantment-level-select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
        }

        .enchantment-name-select {
            flex-grow: 1; 
            padding: 0.6rem 0.8rem; 
            background-color: #ffffff;
            color: #374151;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 1rem; 
            outline: none;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            transition: border-color 0.2s, box-shadow 0.2s;
            appearance: none; 
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="%234b5563" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>'); 
            background-repeat: no-repeat;
            background-position: right 0.5rem center; 
            background-size: 0.7rem; 
            padding-right: 1.6rem; 
        }
        .enchantment-name-select:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
        }

        .my-enchantment-value-input {
            flex-basis: 130px; 
            max-width: 160px; 
            flex-grow: 0; 
            flex-shrink: 0; 
            padding: 0.6rem 0.8rem; 
            background-color: #ffffff;
            color: #374151;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 1rem; 
            outline: none;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            transition: border-color 0.2s, box-shadow 0.2s;
            text-align: right; 
            -moz-appearance: textfield; 
        }
        .my-enchantment-value-input::-webkit-outer-spin-button,
        .my-enchantment-value-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .my-enchantment-value-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
        }
        
        .enchantment-row label {
            display: none; 
        }

        .individual-result-display {
            background-color: #f9fafb; 
            border: 1px solid #e2e8f0; 
            border-radius: 0.5rem;
            padding: 0.75rem; 
            margin-bottom: 0.75rem; 
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            text-align: center;
            color: #374151; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            box-sizing: border-box; 
        }
        .individual-result-display .evaluation-message {
            font-size: 0.9rem; 
            font-weight: 600;
            margin-bottom: 0.2rem; 
            color: #1f2937; 
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis; 
            line-height: 1.2; 
        }
        .individual-result-display .progress-bar-container {
            height: 18px; 
            background-color: #e5e7eb;
            border-radius: 0.5rem;
            overflow: hidden;
            border: 1px solid #d1d5db;
            width: 95%; 
            position: relative; 
            margin-top: 0.2rem; 
            margin-bottom: 0.2rem; 
            box-sizing: border-box; 
        }
        .individual-result-display .progress-bar {
            height: 100%;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.85rem; 
            transition: all 0.5s ease-in-out;
        }
        .individual-result-display .progress-percentage-text {
            color: #ffffff; 
            font-weight: bold; 
            position: absolute; 
            width: 100%;
            text-align: center;
            font-size: 0.9rem; 
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.9); 
        }

        .individual-result-display .min-value-display,
        .individual-result-display .max-value-display {
            font-size: 0.6rem; 
            color: #6b7280;
            margin-top: 0.2rem; 
            line-height: 1.2; 
        }

        .site-footer {
            background-color: #e2e8f0;
            padding: 5px 10px;
            font-size: 0.6rem;
            color: #6b7280;
            border-top: 1px solid #cbd5e0;
            width: 100%; 
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            margin-top: auto; 
        }
        @media (min-width: 640px) {
            .site-footer {
                flex-direction: row;
            }
        }
        .site-footer p {
            color: #6b7280;
        }
        .site-footer a {
            color: #2563eb; 
        }

        .evaluation-panel h2 {
            display: none; 
        }
        
        ::-webkit-scrollbar {
            width: 8px; 
        }
        ::-webkit-scrollbar-track {
            background: #f0f4f8; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e0; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a0aec0; 
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-start">
    <div class="main-container">
        <div class="header-area">
            <h1 class="site-title">ラテール エンチャント評価</h1>

            <div class="header-right-controls">
                <div class="equipment-tabs-container">
                    <button id="tabWeapon" class="active" data-equipment-type="武器">武器</button>
                    <button id="tabSpiritStone" data-equipment-type="精霊石">精霊石</button>
                    <button id="tabArmor" data-equipment-type="防具">防具</button>
                    <button id="tabAccessory" data-equipment-type="アクセサリー">アクセサリー</button>
                </div>
                <div class="batch-level-control">
                    <label for="batchLevelSelect">Lv一括変更:</label>
                    <select id="batchLevelSelect" class="batch-level-select">
                        <option value="Lv2">Lv2</option>
                        <option value="Lv3">Lv3</option>
                        <option value="Lv4">Lv4</option>
                    </select>
                </div>
                <button id="resetButton" class="reset-button">リセット</button>
            </div>
        </div>

        <div class="content-area">
            <div class="input-panel" id="enchantmentInputsContainer">
                </div>

            <div class="evaluation-panel" id="evaluationResultsContainer">
                </div>
        </div>
    </div>

    <div class="site-footer">
        <div class="text-left mb-2 sm:mb-0">
            <p>一部をAIで作成した為計算に間違いがある可能性があります。</p>
            <p>なにかあればこちらまで<a href="https://x.com/XRusenyou" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">https://x.com/XRusenyou</a></p>
        </div>
        <div class="text-right">
            <p>&copy;HappyTuk Co., Ltd. All Rights Reserved.</p>
            <p>&copy;Actoz Soft. All Rights Reserved.</p>
        </div>
    </div>

    <script>
        const rawDataString = `
エンチャントID (シート1のIDと連携),エンチャント名 (シート1から参照),"装備種別 (武器, 防具, アクセサリー)","エンチャントレベル (Lv1, Lv2, Lv3, Lv4)",最小値,最大値,追加エンチャント補正率 (該当しない場合は空欄)（通常エンチャントの数値から80%減少する）（Lv3とLV4にはこの仕様は存在しない）,単位,備考と注意事項 (Lv3/4のエンチャントは全て共通、同数値になる。)（エンチャントには全てLv1が存在するが全て1％または1となります、支配力系とスキルクールタイム減少は例外的に0.1になります。）
4,全ステータス,防具,Lv2,1,16000,,固定値,
4,全ステータス,防具,Lv3,1200,2400,,固定値,Lv4も同数値
4,全ステータス,防具,Lv4,1200,2400,,固定値,Lv3も同数値
5,全ステータス（％）,防具,Lv2,1,18,,％,
5,全ステータス（％）,防具,Lv3,1,3,,％,Lv4も同数値
5,全ステータス（％）,防具,Lv4,1,3,,％,Lv3も同数値
26,クリティカルダメージ（ブーツ）,防具,Lv2,1,150,120,％,
26,クリティカルダメージ（ブーツ）,防具,Lv3,11,23,,％,Lv4も同数値
26,クリティカルダメージ（ブーツ）,防具,Lv4,11,23,,％,Lv3も同数値
2,最大ダメージ,防具,Lv2,1,100,80,％,
2,最大ダメージ,防具,Lv3,7,15,,％,
2,最大ダメージ,防具,Lv4,7,15,,％,
6,武器攻撃力/属性（％）,防具,Lv2,1,15,,％,
6,武器攻撃力/属性（％）,防具,Lv3,1,2,,％,
6,武器攻撃力/属性（％）,防具,Lv4,1,2,,％,
7,武器攻撃力/属性,防具,Lv2,1,170,,固定値,
7,武器攻撃力/属性,防具,Lv3,12,25,,固定値,
7,武器攻撃力/属性,防具,Lv4,12,25,,固定値,
16,ボスモンスター支配力,防具,Lv2,0.1,4.0,,％,支配力は0.1刻みになる
16,ボスモンスター支配力,防具,Lv3,0.3,0.6,,％,支配力は0.1刻みになる
16,ボスモンスター支配力,防具,Lv4,0.3,0.6,,％,支配力は0.1刻みになる
1,クリティカルダメージ,アクセサリー,Lv2,1,70,56,％,
1,クリティカルダメージ,アクセサリー,Lv3,5,10,,％,
1,クリティカルダメージ,アクセサリー,Lv4,5,10,,％,
2,最大ダメージ,アクセサリー,Lv2,1,70,56,％,
2,最大ダメージ,アクセサリー,Lv3,5,10,,％,
2,最大ダメージ,アクセサリー,Lv4,5,10,,％,
3,最小ダメージ,アクセサリー,Lv2,1,70,56,％,
3,最小ダメージ,アクセサリー,Lv3,5,10,,％,
3,最小ダメージ,アクセサリー,Lv4,5,10,,％,
7,武器攻撃力/属性,アクセサリー,Lv2,1,160,128,固定値,
7,武器攻撃力/属性,アクセサリー,Lv3,12,24,,固定値,
7,武器攻撃力/属性,アクセサリー,Lv4,12,24,,固定値,
4,全ステータス,アクセサリー,Lv2,1,11000,8800,固定値,
4,全ステータス,アクセサリー,Lv3,800,1700,,固定値,
4,全ステータス,アクセサリー,Lv4,800,1700,,固定値,
5,全ステータス（％）,アクセサリー,Lv2,1,12,10,％,
5,全ステータス（％）,アクセサリー,Lv3,1,2,,％,
5,全ステータス（％）,アクセサリー,Lv4,1,2,,％,
18,最大HP（％）,アクセサリー,Lv2,1,7,6,％,
18,最大HP（％）,アクセサリー,Lv3,1,2,,％,
18,最大HP（％）,アクセサリー,Lv4,1,2,,％,
19,スキルクールタイム減少,アクセサリー,Lv2,0.1,5.0,4,％,0.1計算になる
19,スキルクールタイム減少,アクセサリー,Lv3,0.4,0.8,,％,0.1計算になる
19,スキルクールタイム減少,アクセサリー,Lv4,0.4,0.8,,％,0.1計算になる
6,武器攻撃力/属性（％）,アクセサリー,Lv2,1,10,8,％,
6,武器攻撃力/属性（％）,アクセサリー,Lv3,1,2,,％,
6,武器攻撃力/属性（％）,アクセサリー,Lv4,1,2,,％,
21,一般モンスター追加ダメージ（％）,アクセサリー,Lv2,1,7,6,％,
21,一般モンスター追加ダメージ（％）,アクセサリー,Lv3,1,2,,％,
21,一般モンスター追加ダメージ（％）,アクセサリー,Lv4,1,2,,％,
23,ボスモンスター追加ダメージ（％）,アクセサリー,Lv2,1,7,6,％,
23,ボスモンスター追加ダメージ（％）,アクセサリー,Lv3,1,2,,％,
23,ボスモンスター追加ダメージ（％）,アクセサリー,Lv4,1,2,,％,
24,貫通力,アクセサリー,Lv2,1,40,32,％,
24,貫通力,アクセサリー,Lv3,3,6,,％,
24,貫通力,アクセサリー,Lv4,3,6,,％,
11,筋力/魔法力,アクセサリー,Lv2,1,14000,11200,固定値,
11,筋力/魔法力,アクセサリー,Lv3,1000,2100,,固定値,
11,筋力/魔法力,アクセサリー,Lv4,1000,2100,,固定値,
12,体力,アクセサリー,Lv2,1,14000,11200,固定値,
12,体力,アクセサリー,Lv3,1000,2100,,固定値,
12,体力,アクセサリー,Lv4,1000,2100,,固定値,
3,最小ダメージ,防具,Lv2,1,100,80,％,
3,最小ダメージ,防具,Lv3,7,15,,％,
3,最小ダメージ,防具,Lv4,7,15,,％,
13,物理/魔法追加ダメージ,アクセサリー,Lv2,1,30000,24000,固定値,
13,物理/魔法追加ダメージ,アクセサリー,Lv3,2200,4500,,固定値,
13,物理/魔法追加ダメージ,アクセサリー,Lv4,2200,4500,,固定値,
14,物理/魔法追加ダメージ（％）,アクセサリー,Lv2,1,7,6,％,
14,物理/魔法追加ダメージ（％）,アクセサリー,Lv3,1,2,,％,
14,物理/魔法追加ダメージ（％）,アクセサリー,Lv4,1,2,,％,
1,クリティカルダメージ,武器,Lv2,1,150,,％,
1,クリティカルダメージ,武器,Lv3,18,18,,％,
1,クリティカルダメージ,武器,Lv4,18,18,,％,
2,最大ダメージ,武器,Lv2,1,220,,％,
2,最大ダメージ,武器,Lv3,26,26,,％,
2,最大ダメージ,武器,Lv4,26,26,,％,
3,最小ダメージ,武器,Lv2,1,250,220,％,
3,最小ダメージ,武器,Lv3,30,30,,％,
3,最小ダメージ,武器,Lv4,30,30,,％,
6,武器攻撃力/属性（％）,武器,Lv2,1,14,,％,
6,武器攻撃力/属性（％）,武器,Lv3,1,2,,％,
6,武器攻撃力/属性（％）,武器,Lv4,1,2,,％,
5,全ステータス（％）,武器,Lv2,1,14,,％,
5,全ステータス（％）,武器,Lv3,1,2,,％,
5,全ステータス（％）,武器,Lv4,1,2,,％,
11,筋力/魔法力,武器,Lv2,1,22000,,固定値,
11,筋力/魔法力,武器,Lv3,2600,2600,,固定値,
11,筋力/魔法力,武器,Lv4,2600,2600,,固定値,
24,貫通力,武器,Lv2,1,50,,％,
24,貫通力,武器,Lv3,6,6,,％,
24,貫通力,武器,Lv4,6,6,,％,
4,全ステータス,武器,Lv2,1,18000,,固定値,
4,全ステータス,武器,Lv3,2200,2200,,固定値,
4,全ステータス,武器,Lv4,2000,2200,,固定値,
13,物理/魔法追加ダメージ,武器,Lv2,1,25000,,固定値,
13,物理/魔法追加ダメージ,武器,Lv3,3000,3000,,固定値,
13,物理/魔法追加ダメージ,武器,Lv4,3000,3000,,固定値,
14,物理/魔法追加ダメージ（％）,武器,Lv2,1,10,,％,
14,物理/魔法追加ダメージ（％）,武器,Lv3,1,2,,％,
14,物理/魔法追加ダメージ（％）,武器,Lv4,1,2,,％,
21,一般モンスター追加ダメージ（％）,武器,Lv2,1,10,,％,
21,一般モンスター追加ダメージ（％）,武器,Lv3,1,2,,％,
21,一般モンスター追加ダメージ（％）,武器,Lv4,1,2,,％,
23,ボスモンスター追加ダメージ（％）,武器,Lv2,1,10,,％,
23,ボスモンスター追加ダメージ（％）,武器,Lv3,1,2,,％,
23,ボスモンスター追加ダメージ（％）,武器,Lv4,1,2,,％,
15,一般モンスター支配力,防具,Lv2,0.1,4.0,,％,支配力は0.1刻みになる
15,一般モンスター支配力,防具,Lv3,0.3,0.6,,％,支配力は0.1刻みになる
15,一般モンスター支配力,防具,Lv4,0.3,0.6,,％,支配力は0.1刻みになる
9,移動速度,防具,Lv2,1,150,,％,
9,移動速度,防具,Lv3,11,23,,％,
9,移動速度,防具,Lv4,11,23,,％,
11,筋力/魔法力,防具,Lv2,1,20000,,固定値,
11,筋力/魔法力,防具,Lv3,1500,3000,,固定値,
11,筋力/魔法力,防具,Lv4,1500,3000,,固定値,
12,体力,防具,Lv2,1,20000,,固定値,
12,体力,防具,Lv3,1500,3000,,固定値,
12,体力,防具,Lv4,1500,3000,,固定値,
18,最大HP（％）,防具,Lv2,1,10,,％,
18,最大HP（％）,防具,Lv3,1,2,,％,
18,最大HP（％）,防具,Lv4,1,2,,％,
1,クリティカルダメージ,防具,Lv2,1,100,,％,グローブとヘルムに該当
1,クリティカルダメージ,防具,Lv3,7,15,,％,
1,クリティカルダメージ,防具,Lv4,7,15,,％,
14,物理/魔法追加ダメージ（％）,防具,Lv2,1,10,,％,
14,物理/魔法追加ダメージ（％）,防具,Lv3,1,2,,％,
14,物理/魔法追加ダメージ（％）,防具,Lv4,1,2,,％,
8,命中率,防具,Lv2,1,150,,％,
8,命中率,防具,Lv3,11,23,,％,
8,命中率,防具,Lv4,11,23,,％,
2,最大ダメージ,精霊石,Lv2,1,120,,％,
2,最大ダメージ,精霊石,Lv3,14,14,,％,
2,最大ダメージ,精霊石,Lv4,14,14,,％,
3,最小ダメージ,精霊石,Lv2,1,150,,％,
3,最小ダメージ,精霊石,Lv3,18,18,,％,
3,最小ダメージ,精霊石,Lv4,18,18,,％,
8,命中率,精霊石,Lv2,1,50,,％,
8,命中率,精霊石,Lv3,6,6,,％,
8,命中率,精霊石,Lv4,6,6,,％,
10,筋力/魔法力（％）,精霊石,Lv2,1,9,,％,
10,筋力/魔法力（％）,精霊石,Lv3,1,1,,％,
10,筋力/魔法力（％）,精霊石,Lv4,1,1,,％,
7,武器攻撃力/属性,精霊石,Lv2,1,150,,％,
7,武器攻撃力/属性,精霊石,Lv3,18,18,,％,
7,武器攻撃力/属性,精霊石,Lv4,18,18,,％,
11,筋力/魔法力,精霊石,Lv2,1,14000,,固定値,
11,筋力/魔法力,精霊石,Lv3,1700,1700,,固定値,
11,筋力/魔法力,精霊石,Lv4,1700,1700,,固定値,
4,全ステータス,精霊石,Lv2,1,11000,,固定値,
4,全ステータス,精霊石,Lv3,1300,1300,,固定値,
4,全ステータス,精霊石,Lv4,1300,1300,,固定値,
18,最大HP（％）,精霊石,Lv2,1,10,,％,
18,最大HP（％）,精霊石,Lv3,1,1,,％,
18,最大HP（％）,精霊石,Lv4,1,1,,％,
14,物理/魔法追加ダメージ（％）,精霊石,Lv2,1,9,,％,
14,物理/魔法追加ダメージ（％）,精霊石,Lv3,1,1,,％,
14,物理/魔法追加ダメージ（％）,精霊石,Lv4,1,1,,％,
13,物理/魔法追加ダメージ,精霊石,Lv2,1,20000,,固定値,
13,物理/魔法追加ダメージ,精霊石,Lv3,2400,2400,,固定値,
13,物理/魔法追加ダメージ,精霊石,Lv4,2400,2400,,固定値,
20,一般モンスター追加ダメージ,精霊石,Lv2,1,23000,,固定値,
20,一般モンスター追加ダメージ,精霊石,Lv3,2800,2800,,固定値,
20,一般モンスター追加ダメージ,精霊石,Lv4,2800,2800,,固定値,
22,ボスモンスター追加ダメージ,精霊石,Lv2,1,23000,,固定値,
22,ボスモンスター追加ダメージ,精霊石,Lv3,2800,2800,,固定値,
22,ボスモンスター追加ダメージ,精霊石,Lv4,2800,2800,,固定値,
`;

        // Function to parse the raw data string into a structured JavaScript array
        function parseEnchantmentData(rawDataString) {
            const lines = rawDataString.trim().split('\n').slice(1); 
            const parsedData = {};

            const decimalBaseEnchantNames = ['一般モンスター支配力', 'ボスモンスター支配力', 'スキルクールタイム減少'];

            lines.forEach(line => {
                const parts = line.split(',');
                if (parts.length < 9) {
                    console.warn('Skipping malformed line:', line);
                    return;
                }

                const id = parseInt(parts[0]);
                const name = parts[1].trim(); 
                let equipment = parts[2].trim(); 
                const level = parts[3].trim(); 
                const minVal = parts[4].trim() === '?' || parts[4].trim() === '' ? null : parseFloat(parts[4]);
                const maxVal = parts[5].trim() === '?' || parts[5].trim() === '' ? null : parseFloat(parts[5]);
                const unit = parts[7].trim(); 

                if (equipment.includes('防具（')) {
                    equipment = '防具';
                }

                const key = `${equipment}-${name}`;

                if ((equipment === '防具' || equipment === 'アクセサリー') && name === '体力') {
                    return;
                }

                if (!parsedData[key]) {
                    parsedData[key] = {
                        id: id,
                        name: name,
                        equipment: equipment,
                        unit: unit,
                        levels: {}
                    };
                    parsedData[key].levels.Lv1 = { base_value: decimalBaseEnchantNames.includes(name) ? 0.1 : 1 };
                }

                parsedData[key].levels[level] = { min_add: minVal, max_add: maxVal };
            });

            return Object.values(parsedData);
        }

        const customEquipmentOrder = ["武器", "精霊石", "防具", "アクセサリー"];

        const customEnchantmentNameOrder = {
            "武器": [
                "クリティカルダメージ", "最大ダメージ", "最小ダメージ", "武器攻撃力/属性（％）",
                "全ステータス（％）", "全ステータス", "筋力/魔法力", "貫通力",
                "物理/魔法追加ダメージ", "物理/魔法追加ダメージ（％）", 
                "一般モンスター追加ダメージ（％）", "ボスモンスター追加ダメージ（％）"
            ],
            "防具": [
                "クリティカルダメージ", "最大ダメージ", "最小ダメージ", "武器攻撃力/属性",
                "武器攻撃力/属性（％）", "全ステータス（％）", "全ステータス", "筋力/魔法力",
                "クリティカルダメージ（ブーツ）", "移動速度", "命中率", "最大HP（％）",
                "一般モンスター支配力", "ボスモンスター支配力", "物理/魔法追加ダメージ（％）"
            ],
            "アクセサリー": [
                "クリティカルダメージ", "最大ダメージ", "最小ダメージ", "武器攻撃力/属性",
                "武器攻撃力/属性（％）", "全ステータス（％）", "全ステータス", "筋力/魔法力",
                "貫通力", "スキルクールタイム減少", "最大HP（％）", "物理/魔法追加ダメージ",
                "物理/魔法追加ダメージ（％）", "一般モンスター追加ダメージ（％）", "ボスモンスター追加ダメージ（％）"
            ],
            "精霊石": [
                "最大ダメージ", "最小ダメージ", "武器攻撃力/属性", "筋力/魔法力（％）",
                "筋力/魔法力", "全ステータス", "命中率", "最大HP（％）",
                "物理/魔法追加ダメージ（％）", "一般モンスター追加ダメージ", "ボスモンスター追加ダメージ"
            ]
        };

        const enchantmentData = parseEnchantmentData(rawDataString);

        let currentSelectedEquipmentType = '武器'; 
        let enchantmentRowCount = 0; 
        const enchantmentRowsByEquipment = {
            "武器": [], "精霊石": [], "防具": [], "アクセサリー": []
        };
        const DEFAULT_ROWS_PER_EQUIPMENT_TYPE = 5;

        let enchantmentInputsContainer;
        let evaluationResultsContainer;
        let equipmentTabButtons;
        let resetButton; 
        let batchLevelSelect; 

        function populateEnchantmentNames(equipmentTypeForThisRow, enchantmentNameSelectElement, selectedName = null) {
            enchantmentNameSelectElement.innerHTML = ''; 

            if (equipmentTypeForThisRow) {
                const filteredEnchants = enchantmentData.filter(e => e.equipment === equipmentTypeForThisRow);
                let enchantmentNames = [...new Set(filteredEnchants.map(e => e.name))];

                if (customEnchantmentNameOrder[equipmentTypeForThisRow]) {
                    const order = customEnchantmentNameOrder[equipmentTypeForThisRow];
                    enchantmentNames.sort((a, b) => {
                        const indexA = order.indexOf(a);
                        const indexB = order.indexOf(b);
                        if (indexA === -1 && indexB === -1) return 0;
                        if (indexA === -1) return 1;
                        if (indexB === -1) return -1;
                        return indexA - indexB;
                    });
                } else {
                    enchantmentNames.sort();
                }

                enchantmentNames.forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name;
                    enchantmentNameSelectElement.appendChild(option);
                });

                if (selectedName && enchantmentNames.includes(selectedName)) {
                    enchantmentNameSelectElement.value = selectedName;
                } else if (enchantmentNames.length > 0) {
                    enchantmentNameSelectElement.value = enchantmentNames[0]; 
                }
            }
        }

        function calculateEffectiveMinMax(fullEnchantData, targetLevel) {
            let baseValue = fullEnchantData.levels.Lv1.base_value || 0;
            let cumulativeMinAdd = 0;
            let cumulativeMaxAdd = 0;
            const levelOrder = ["Lv2", "Lv3", "Lv4"];
            
            if (targetLevel === "Lv1") {
                return { min: baseValue, max: baseValue };
            }

            for (const level of levelOrder) {
                if (fullEnchantData.levels[level] &&
                    typeof fullEnchantData.levels[level].min_add === 'number' &&
                    typeof fullEnchantData.levels[level].max_add === 'number') {

                    if (levelOrder.indexOf(level) <= levelOrder.indexOf(targetLevel)) {
                        cumulativeMinAdd += fullEnchantData.levels[level].min_add;
                        cumulativeMaxAdd += fullEnchantData.levels[level].max_add;
                    }
                } else if (levelOrder.indexOf(level) <= levelOrder.indexOf(targetLevel)) {
                    return { min: null, max: null };
                }

                if (level === targetLevel) {
                    break;
                }
            }
            return { min: baseValue + cumulativeMinAdd, max: baseValue + cumulativeMaxAdd };
        }

        function addEnchantmentRowToCategory(equipmentType, defaultLevel = 'Lv4', defaultEnchantmentName = 'クリティカルダメージ') {
            const rowId = `enchantment-row-${enchantmentRowCount++}`;

            const newRow = document.createElement('div');
            newRow.id = rowId;
            newRow.classList.add('enchantment-row'); 
            newRow.dataset.equipmentType = equipmentType; 
            newRow.style.display = 'none'; 

            const resultDisplayDiv = document.createElement('div');
            resultDisplayDiv.id = `result-display-${rowId}`;
            resultDisplayDiv.classList.add('individual-result-display');
            resultDisplayDiv.style.display = 'none'; 

            newRow.innerHTML = `
                <div class="enchant-level-name-group">
                    <select id="enchantmentLevel-${rowId}" class="enchantment-level-select">
                        <option value="Lv2">Lv2</option>
                        <option value="Lv3">Lv3</option>
                        <option value="Lv4">Lv4</option>
                    </select>
                    <select id="enchantmentName-${rowId}" class="enchantment-name-select">
                    </select>
                </div>
                <input type="number" id="myEnchantmentValue-${rowId}" class="my-enchantment-value-input" placeholder="数値を入力">
            `;
            
            resultDisplayDiv.innerHTML = `
                <p class="evaluation-message"></p>
                <div class="progress-bar-container">
                    <div class="progress-bar">
                        <span class="progress-percentage-text"></span>
                    </div>
                </div>
                <div class="min-max-display text-xs text-gray-600">
                    <span class="min-value-display">最小値: -</span> | <span class="max-value-display">最大値: -</span>
                </div>
            `;

            if (enchantmentInputsContainer) {
                enchantmentInputsContainer.appendChild(newRow);
            }
            if (evaluationResultsContainer) {
                evaluationResultsContainer.appendChild(resultDisplayDiv);
            }

            const levelSelect = newRow.querySelector(`#enchantmentLevel-${rowId}`);
            const nameSelect = newRow.querySelector(`#enchantmentName-${rowId}`);
            const valueInput = newRow.querySelector(`#myEnchantmentValue-${rowId}`);
            
            levelSelect.addEventListener('change', () => updateEvaluationResult(rowId, equipmentType));
            nameSelect.addEventListener('change', () => {
                updateEvaluationResult(rowId, equipmentType);
            });
            valueInput.addEventListener('input', () => updateEvaluationResult(rowId, equipmentType));

            let defaultNameForNewRow = defaultEnchantmentName;
            if (equipmentType === '精霊石' && !customEnchantmentNameOrder['精霊石'].includes('クリティカルダメージ')) {
                defaultNameForNewRow = '最大ダメージ';
            }
            populateEnchantmentNames(equipmentType, nameSelect, defaultNameForNewRow);
            levelSelect.value = defaultLevel;
            updateEvaluationResult(rowId, equipmentType); 

            enchantmentRowsByEquipment[equipmentType].push({
                id: rowId,
                rowElement: newRow,
                resultDisplayDiv: resultDisplayDiv,
                levelSelect: levelSelect,
                nameSelect: nameSelect,
                valueInput: valueInput
            });
        }

        function updateEvaluationResult(rowId, equipmentType) {
            const rowData = enchantmentRowsByEquipment[equipmentType].find(row => row.id === rowId);
            if (!rowData) return;

            const selectedLevel = rowData.levelSelect.value;
            const selectedEnchantmentName = rowData.nameSelect.value;
            const myValue = parseFloat(rowData.valueInput.value);

            const fullEnchantData = enchantmentData.find(e => e.name === selectedEnchantmentName && e.equipment === equipmentType);
            const messageDisplay = rowData.resultDisplayDiv.querySelector('.evaluation-message');
            const progressBar = rowData.resultDisplayDiv.querySelector('.progress-bar');
            const percentageText = rowData.resultDisplayDiv.querySelector('.progress-percentage-text');
            const minValueDisplay = rowData.resultDisplayDiv.querySelector('.min-value-display');
            const maxValueDisplay = rowData.resultDisplayDiv.querySelector('.max-value-display');

            const requiresOneDecimal = ['一般モンスター支配力', 'ボスモンスター支配力', 'スキルクールタイム減少'].includes(selectedEnchantmentName);

            rowData.resultDisplayDiv.style.display = 'flex'; 

            if (isNaN(myValue) || rowData.valueInput.value.trim() === '') {
                messageDisplay.textContent = `${selectedEnchantmentName} (${selectedLevel})`;
                progressBar.style.width = '0%';
                progressBar.style.backgroundColor = '#e5e7eb'; 
                percentageText.textContent = ''; 
                minValueDisplay.textContent = '最小値: -';
                maxValueDisplay.textContent = '最大値: -';
                syncRowHeights(); 
                return; 
            }

            if (!fullEnchantData) {
                messageDisplay.textContent = `${selectedEnchantmentName} (${selectedLevel})`;
                progressBar.style.width = '0%';
                progressBar.style.backgroundColor = '#e5e7eb';
                percentageText.textContent = '';
                minValueDisplay.textContent = '最小値: -';
                maxValueDisplay.textContent = '最大値: -';
                syncRowHeights(); 
                return;
            }

            const { min: effectiveMin, max: effectiveMax } = calculateEffectiveMinMax(fullEnchantData, selectedLevel);

            let formattedMin = effectiveMin;
            let formattedMax = effectiveMax;
            let unitToDisplay = fullEnchantData.unit === '%' ? '%' : ''; 

            if (requiresOneDecimal) {
                if (effectiveMin !== null) formattedMin = effectiveMin.toFixed(1);
                if (effectiveMax !== null) formattedMax = effectiveMax.toFixed(1);
                unitToDisplay = ''; 
            } else {
                if (fullEnchantData.unit === '固定値' && effectiveMin !== null && Number.isInteger(effectiveMin)) {
                    formattedMin = effectiveMin.toFixed(0);
                    formattedMax = effectiveMax.toFixed(0);
                } else {
                    if (effectiveMin !== null) formattedMin = effectiveMin;
                    if (effectiveMax !== null) formattedMax = effectiveMax;
                }
            }

            if (effectiveMin === null || effectiveMax === null) {
                messageDisplay.textContent = `${selectedEnchantmentName} (${selectedLevel})`; 
                progressBar.style.width = '0%';
                progressBar.style.backgroundColor = '#e5e7eb';
                percentageText.textContent = '';
                minValueDisplay.textContent = `最小値: 不明`;
                maxValueDisplay.textContent = `最大値: 不明`;
                syncRowHeights(); 
                return;
            }

            if (myValue < effectiveMin || myValue > effectiveMax) {
                messageDisplay.textContent = `${selectedEnchantmentName} (${selectedLevel})`; 
                progressBar.style.width = '0%';
                progressBar.style.backgroundColor = '#fca5a5'; 
                percentageText.textContent = '';
                minValueDisplay.textContent = `最小値: ${formattedMin}${unitToDisplay}`;
                maxValueDisplay.textContent = `最大値: ${formattedMax}${unitToDisplay}`;
                syncRowHeights(); 
                return;
            }

            let percentage = 0;
            if (effectiveMax === effectiveMin) { 
                percentage = 100;
            } else {
                percentage = ((myValue - effectiveMin) / (effectiveMax - effectiveMin)) * 100;
            }
            percentage = Math.max(0, Math.min(100, percentage)); 

            let color = '';

            if (percentage >= 95) {
                color = '#10b981'; 
            } else if (percentage >= 80) {
                color = '#22c55e'; 
            } else if (percentage >= 60) {
                color = '#34d399'; 
            } else if (percentage >= 40) {
                color = '#facc15'; 
            } else if (percentage >= 20) {
                color = '#fbbf24'; 
            } else {
                color = '#ef4444'; 
            }

            messageDisplay.textContent = `${selectedEnchantmentName} (${selectedLevel})`; 
            progressBar.style.width = `${percentage}%`;
            progressBar.style.backgroundColor = color;
            percentageText.textContent = `${percentage.toFixed(1)}%`;
            minValueDisplay.textContent = `最小値: ${formattedMin}${unitToDisplay}`;
            maxValueDisplay.textContent = `最大値: ${formattedMax}${unitToDisplay}`;
            syncRowHeights(); 
        }

        function syncRowHeights() {
            const visibleEnchantmentRows = Array.from(enchantmentInputsContainer.querySelectorAll('.enchantment-row'))
                                                .filter(row => row.style.display !== 'none');

            visibleEnchantmentRows.forEach(rowElement => {
                const rowId = rowElement.id;
                const resultDisplayDiv = document.getElementById(`result-display-${rowId}`);

                if (resultDisplayDiv) {
                    rowElement.style.minHeight = 'auto';
                    resultDisplayDiv.style.minHeight = 'auto';

                    const leftHeight = rowElement.offsetHeight;
                    const rightHeight = resultDisplayDiv.offsetHeight;

                    const maxHeight = Math.max(leftHeight, rightHeight);

                    rowElement.style.minHeight = `${maxHeight}px`;
                    resultDisplayDiv.style.minHeight = `${maxHeight}px`;
                }
            });
        }

        function switchEquipmentType(newEquipmentType) {
            currentSelectedEquipmentType = newEquipmentType;

            equipmentTabButtons.forEach(button => {
                button.classList.remove('active');
                if (button.dataset.equipmentType === newEquipmentType) {
                    button.classList.add('active');
                }
            });

            Object.values(enchantmentRowsByEquipment).forEach(rows => {
                rows.forEach(rowData => {
                    rowData.rowElement.style.display = 'none';
                    rowData.resultDisplayDiv.style.display = 'none';
                });
            });

            const currentBatchLevel = batchLevelSelect ? batchLevelSelect.value : 'Lv4'; 

            if (enchantmentRowsByEquipment[newEquipmentType].length === 0) {
                for (let i = 0; i < DEFAULT_ROWS_PER_EQUIPMENT_TYPE; i++) {
                    const defaultEnchantment = (newEquipmentType === '精霊石') ? '最大ダメージ' : 'クリティカルダメージ';
                    addEnchantmentRowToCategory(newEquipmentType, currentBatchLevel, defaultEnchantment);
                }
            }
            
            enchantmentRowsByEquipment[newEquipmentType].forEach(rowData => {
                rowData.rowElement.style.display = 'flex';
                rowData.levelSelect.value = currentBatchLevel; 
                updateEvaluationResult(rowData.id, currentSelectedEquipmentType);
            });
            syncRowHeights();
        }

        function resetInputValues() {
            enchantmentRowsByEquipment[currentSelectedEquipmentType].forEach(rowData => {
                rowData.valueInput.value = ''; 
                updateEvaluationResult(rowData.id, currentSelectedEquipmentType); 
            });
            syncRowHeights(); 
        }

        window.onload = function () {
            enchantmentInputsContainer = document.getElementById('enchantmentInputsContainer');
            evaluationResultsContainer = document.getElementById('evaluationResultsContainer');
            equipmentTabButtons = document.querySelectorAll('.equipment-tabs-container button');
            resetButton = document.getElementById('resetButton');
            batchLevelSelect = document.getElementById('batchLevelSelect'); 

            equipmentTabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const equipmentType = button.dataset.equipmentType;
                    switchEquipmentType(equipmentType);
                });
            });

            resetButton.addEventListener('click', resetInputValues); 

            if (batchLevelSelect) {
                batchLevelSelect.addEventListener('change', () => {
                    const newBatchLevel = batchLevelSelect.value;
                    enchantmentRowsByEquipment[currentSelectedEquipmentType].forEach(rowData => {
                        rowData.levelSelect.value = newBatchLevel;
                        updateEvaluationResult(rowData.id, currentSelectedEquipmentType);
                    });
                    syncRowHeights(); 
                });
            }

            switchEquipmentType(currentSelectedEquipmentType);
            window.addEventListener('resize', syncRowHeights); 
        };
    </script>
</body>
</html>
